# 分布式事务的解决方案全家桶

补偿机制，是否与Redis更新数据库，删除缓存，后面的补偿机制相同。

# 设计模式的使用

# Spring IOC AOP

# MyBatis方面

# Redis时间过期，还在执行，怎么解决？

# 分布式锁的实现方式

基于数据库
基于缓存
基于ZK

主动还款与批量扣款的对共享数据拮据的改变，使用排他锁。

基于MySQL的分布式锁，当连接关闭，锁释放。所以不会设置锁过期时间。不过，后续竞争锁会同步阻塞，超过innodb_lock_wait_timeout时间设置后会抛出异常。

从业务场景考虑，一般锁持有时间不会太长，所以这种方案还没有问题。

也可以这么解决：

借据中有个字段，表明锁状态.
开启事务:无锁判断锁状态,防止阻塞,如果批扣在进行,则返回失败
排他锁占有数据,然后判断锁状态,进行设置.





